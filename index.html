<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>åå°„ç¥çµŒãƒ†ã‚¹ãƒˆï¼šå½¼å¥³ã‚’æ¢ã›ï¼</title>
<style>
  body {
    margin: 0;
    font-family: sans-serif;
    background-color: #f0f2f5;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    /* ã‚¿ãƒƒãƒ—æ™‚ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’ç„¡åŠ¹åŒ– */
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
  }

  #game-area {
    width: 90%;
    max-width: 400px;
    height: 300px;
    background-color: #fff;
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 2rem;
    font-weight: bold;
    color: #333;
    position: relative;
    overflow: hidden;
    border: 3px solid #ddd;
    transition: border-color 0.1s, background-color 0.1s;
  }

  /* ã‚¿ãƒƒãƒ—å¯èƒ½ãªçŠ¶æ…‹ */
  #game-area.active {
    cursor: pointer;
  }
  
  /* ãŠæ‰‹ä»˜ãæ™‚ã®æ¼”å‡ºï¼ˆèµ¤ããƒ•ãƒ©ãƒƒã‚·ãƒ¥ï¼‰ */
  #game-area.miss {
    border-color: #ff3838 !important;
    background-color: #ffecec !important;
    color: #ff3838 !important;
  }
  
  /* æ­£è§£æ™‚ã®æ¼”å‡ºï¼ˆé’ããƒ•ãƒ©ãƒƒã‚·ãƒ¥ï¼‰ */
  #game-area.hit {
    border-color: #2ecc71 !important;
    background-color: #e8f8f0 !important;
     color: #2ecc71 !important;
  }

  #start-btn {
    margin-top: 30px;
    padding: 15px 40px;
    font-size: 1.2rem;
    font-weight: bold;
    color: #fff;
    background: linear-gradient(45deg, #ff6b6b, #ff8e53);
    border: none;
    border-radius: 50px;
    box-shadow: 0 4px 10px rgba(255, 107, 107, 0.3);
    cursor: pointer;
    transition: transform 0.1s;
  }
  #start-btn:active {
    transform: scale(0.95);
  }
  #start-btn:disabled {
      opacity: 0.5;
      cursor: default;
  }

  #result-area {
    margin-top: 20px;
    text-align: center;
    display: none; /* æœ€åˆã¯éš ã—ã¦ãŠã */
  }
  .result-text {
      font-size: 1.1rem;
      margin: 5px 0;
  }
  .score {
      font-size: 1.8rem;
      font-weight: bold;
      color: #ff6b6b;
  }

  /* ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³è¡¨ç¤º */
  #countdown {
      position: absolute;
      font-size: 4rem;
      color: #ff6b6b;
      display: none;
  }
</style>
</head>
<body>

<div id="game-area">
    <span id="display-text">ã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</span>
    <div id="countdown"></div>
</div>

<button id="start-btn">ã‚¹ã‚¿ãƒ¼ãƒˆï¼</button>

<div id="result-area">
  <h2>çµæœç™ºè¡¨</h2>
  <p class="result-text">å¹³å‡åå¿œé€Ÿåº¦: <span id="avg-speed" class="score">0.000</span> ç§’</p>
  <p class="result-text">ãŠæ‰‹ä»˜ãå›æ•°: <span id="miss-count" class="score">0</span> å›</p>
</div>


<script>
  const gameArea = document.getElementById('game-area');
  const displayText = document.getElementById('display-text');
  const startBtn = document.getElementById('start-btn');
  const resultArea = document.getElementById('result-area');
  const avgSpeedSpan = document.getElementById('avg-speed');
  const missCountSpan = document.getElementById('miss-count');
  const countdownSpan = document.getElementById('countdown');

  let isPlaying = false;
  let canTap = false;
  let currentTargetIsTarget = false; // ä»Šè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã®ãŒã€Œå½¼å¥³ã€ã‹ã©ã†ã‹
  let startTime;
  let reactionTimes = [];
  let missCount = 0;
  let trialCount = 0;
  const maxTrials = 10; // å…¨10å›
  let trialTimeout;

  // ã‚²ãƒ¼ãƒ é–‹å§‹
  startBtn.addEventListener('click', startGame);

  // ç”»é¢ã‚¿ãƒƒãƒ—åˆ¤å®š
  gameArea.addEventListener('touchstart', handleTap); // ã‚¹ãƒãƒ›ç”¨
  gameArea.addEventListener('mousedown', handleTap);  // PCç”¨

  function startGame() {
    startBtn.disabled = true;
    startBtn.textContent = "ã‚²ãƒ¼ãƒ ä¸­...";
    resultArea.style.display = 'none';
    reactionTimes = [];
    missCount = 0;
    trialCount = 0;
    displayText.textContent = "";
    
    // ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³é–‹å§‹
    let count = 3;
    countdownSpan.style.display = 'block';
    countdownSpan.textContent = count;
    
    const countTimer = setInterval(() => {
        count--;
        if(count > 0) {
            countdownSpan.textContent = count;
        } else {
            clearInterval(countTimer);
            countdownSpan.style.display = 'none';
            isPlaying = true;
            nextTrial();
        }
    }, 1000);
  }

  function nextTrial() {
    if (trialCount >= maxTrials) {
      endGame();
      return;
    }

    trialCount++;
    canTap = false;
    gameArea.classList.remove('active');
    displayText.textContent = ""; // ä¸€æ—¦ã‚¯ãƒªã‚¢

    // ãƒ©ãƒ³ãƒ€ãƒ ãªå¾…ã¡æ™‚é–“ï¼ˆ1ç§’ã€œ3ç§’ï¼‰
    const waitTime = Math.random() * 2000 + 1000;

    trialTimeout = setTimeout(() => {
      // 50%ã®ç¢ºç‡ã§ã€Œå½¼å¥³ã€ã‚’è¡¨ç¤º
      currentTargetIsTarget = Math.random() < 0.5;
      
      if (currentTargetIsTarget) {
        displayText.textContent = "ğŸ‘© å½¼å¥³ï¼"; // ã“ã“ã‚’ç”»åƒã‚¿ã‚°ã«å¤‰ãˆã‚‹
      } else {
        displayText.textContent = "ğŸ‘¤ é•ã†äºº"; // ã“ã“ã‚’ç”»åƒã‚¿ã‚°ã«å¤‰ãˆã‚‹
      }
      
      gameArea.classList.add('active');
      startTime = Date.now();
      canTap = true;

      // 2ç§’ä»¥å†…ã«ã‚¿ãƒƒãƒ—ã•ã‚Œãªã‹ã£ãŸã‚‰æ¬¡ã¸ï¼ˆã‚¹ãƒ«ãƒ¼åˆ¤å®šï¼‰
      trialTimeout = setTimeout(() => {
          if(canTap) {
            // å½¼å¥³ã ã£ãŸã®ã«è¦‹é€ƒã—ãŸ
            if(currentTargetIsTarget) {
                missCount++;
                flashArea('miss');
            }
            nextTrial();
          }
      }, 2000);

    }, waitTime);
  }

  function handleTap(e) {
    e.preventDefault(); // ãƒ€ãƒ–ãƒ«ã‚¿ãƒƒãƒ—æ‹¡å¤§ãªã©ã‚’é˜²ã
    if (!isPlaying || !canTap) return;

    const endTime = Date.now();
    const reactionTime = (endTime - startTime) / 1000; // ç§’ã«å¤‰æ›
    canTap = false;
    clearTimeout(trialTimeout); // ã‚¹ãƒ«ãƒ¼åˆ¤å®šã‚¿ã‚¤ãƒãƒ¼ã‚’è§£é™¤

    if (currentTargetIsTarget) {
      // æ­£è§£ï¼ˆå½¼å¥³ã‚’ã‚¿ãƒƒãƒ—ï¼‰
      reactionTimes.push(reactionTime);
      flashArea('hit');
    } else {
      // ãŠæ‰‹ä»˜ãï¼ˆé•ã†äººã‚’ã‚¿ãƒƒãƒ—ï¼‰
      missCount++;
      flashArea('miss');
    }
    
    // å°‘ã—å¾…ã£ã¦ã‹ã‚‰æ¬¡ã¸
    setTimeout(nextTrial, 500);
  }
  
  // ç”»é¢ã‚’ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã•ã›ã‚‹æ¼”å‡º
  function flashArea(type) {
      gameArea.classList.add(type);
      setTimeout(() => {
          gameArea.classList.remove(type);
      }, 300);
  }

  function endGame() {
    isPlaying = false;
    startBtn.disabled = false;
    startBtn.textContent = "ã‚‚ã†ä¸€åº¦ãƒãƒ£ãƒ¬ãƒ³ã‚¸";
    
    // å¹³å‡ã‚¿ã‚¤ãƒ è¨ˆç®—
    let avgSpeed = 0;
    if (reactionTimes.length > 0) {
        const sum = reactionTimes.reduce((a, b) => a + b, 0);
        avgSpeed = sum / reactionTimes.length;
    }

    avgSpeedSpan.textContent = avgSpeed.toFixed(3); // å°æ•°ç‚¹ç¬¬3ä½ã¾ã§
    missCountSpan.textContent = missCount;
    resultArea.style.display = 'block';
  }
</script>
</body>
</html>
